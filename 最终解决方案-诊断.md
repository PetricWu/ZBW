# ğŸ”´ æœ€ç»ˆè§£å†³æ–¹æ¡ˆ - è¯Šæ–­ + ä¿®å¤

## âš ï¸ é—®é¢˜åˆ†æ

**é”™è¯¯**ï¼š`/var/task/markdown` ç›®å½•ä¸å­˜åœ¨

**åŸå› **ï¼šNetlify Functions è¿è¡Œåœ¨éš”ç¦»çš„ Lambda ç¯å¢ƒä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿå’Œé™æ€ç½‘ç«™éƒ¨ç½²ä¸åŒã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨è¯Šæ–­å·¥å…·

### Step 1: åˆ›å»ºè¯Šæ–­å‡½æ•°

åœ¨ GitHub åˆ›å»º `netlify/functions/diagnostic.js`ï¼Œå¤åˆ¶ä»¥ä¸‹ä»£ç ï¼š

```javascript
/**
 * è¯Šæ–­ç‰ˆæœ¬ - åˆ—å‡ºæ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶
 */

const fs = require('fs');
const path = require('path');

exports.handler = async (event, context) => {
  console.log('========================================');
  console.log('è¯Šæ–­å·¥å…·');
  console.log('__dirname:', __dirname);
  console.log('cwd:', process.cwd());
  console.log('========================================');

  try {
    const results = {
      __dirname: __dirname,
      cwd: process.cwd(),
      scanned: []
    };

    // æ‰«æå„ä¸ªå¯èƒ½çš„ç›®å½•
    const dirsToScan = [
      '/',
      '/var',
      '/var/task',
      process.cwd(),
      __dirname,
      path.join(__dirname, '..'),
      path.join(__dirname, '..', '..'),
    ];

    for (const dir of dirsToScan) {
      try {
        if (fs.existsSync(dir)) {
          const files = fs.readdirSync(dir);
          results.scanned.push({
            path: dir,
            exists: true,
            files: files,
            hasMarkdown: files.some(f => f === 'markdown')
          });
        } else {
          results.scanned.push({
            path: dir,
            exists: false,
            files: []
          });
        }
      } catch (error) {
        results.scanned.push({
          path: dir,
          exists: false,
          error: error.message
        });
      }
    }

    // æŸ¥æ‰¾æ‰€æœ‰ .md æ–‡ä»¶
    const allMarkdownFiles = [];
    function scanDirRecursive(dir, depth = 0) {
      if (depth > 4) return;
      try {
        const files = fs.readdirSync(dir);
        for (const file of files) {
          const fullPath = path.join(dir, file);
          try {
            const stat = fs.statSync(fullPath);
            if (stat.isDirectory()) {
              scanDirRecursive(fullPath, depth + 1);
            } else if (file.endsWith('.md')) {
              allMarkdownFiles.push(fullPath);
            }
          } catch (e) {
            // å¿½ç•¥é”™è¯¯
          }
        }
      } catch (error) {
        // å¿½ç•¥é”™è¯¯
      }
    }

    scanDirRecursive('/var/task', 0);

    results.markdownFiles = allMarkdownFiles;

    return {
      statusCode: 200,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(results, null, 2)
    };

  } catch (error) {
    return {
      statusCode: 500,
      body: JSON.stringify({
        error: error.message,
        stack: error.stack
      })
    };
  }
};
```

### Step 2: è¿è¡Œè¯Šæ–­

éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®ï¼š
```
https://earnest-figolla-70c546.netlify.app/.netlify/functions/diagnostic
```

### Step 3: æŸ¥çœ‹ç»“æœ

è¯Šæ–­ç»“æœä¼šæ˜¾ç¤ºï¼š
- å“ªäº›ç›®å½•å­˜åœ¨
- æ¯ä¸ªç›®å½•é‡Œæœ‰ä»€ä¹ˆæ–‡ä»¶
- æ‰€æœ‰ `.md` æ–‡ä»¶çš„ä½ç½®

---

## ğŸ¯ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

å¦‚æœä½ ä¸ç€æ€¥ä½¿ç”¨ Functionsï¼Œå¯ä»¥å…ˆç¦ç”¨å®ƒï¼š

### æ–¹æ³•ï¼šä¿®æ”¹ netlify.toml

åœ¨ GitHub ç¼–è¾‘ `netlify.toml`ï¼Œæ³¨é‡Šæ‰é‡å®šå‘ï¼š

```toml
# [[redirects]]
#   from = "/api/update-index"
#   to = "/.netlify/functions/update-index"
#   status = 200
#   force = true
```

è¿™æ ·ï¼š
- âœ… å‰ç«¯ç»§ç»­ä½¿ç”¨é™æ€çš„ `/markdown/index.json`
- âœ… ç½‘ç«™å®Œå…¨æ­£å¸¸
- âœ… Functions æš‚æ—¶ä¸å¯ç”¨

---

## ğŸ’¡ æ ¹æœ¬åŸå› 

Netlify çš„ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼š

### é™æ€ç½‘ç«™ï¼ˆä½ çš„ç½‘ç«™ï¼‰
- æ–‡ä»¶éƒ¨ç½²åœ¨ CDN
- é€šè¿‡ URL è®¿é—®ï¼š`/markdown/index.json`
- âœ… å¯ä»¥è®¿é—®

### Netlify Functions
- è¿è¡Œåœ¨ Lambda ç¯å¢ƒ
- æ–‡ä»¶ç³»ç»Ÿéš”ç¦»
- âŒ æ— æ³•è®¿é—®é™æ€ç½‘ç«™æ–‡ä»¶

---

## ğŸ“Š å»ºè®®æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šä½¿ç”¨ Netlify Blob Storageï¼ˆæ¨èï¼‰

1. ä½¿ç”¨ Netlify çš„å¯¹è±¡å­˜å‚¨
2. ä¸Šä¼  markdown æ–‡ä»¶åˆ°å­˜å‚¨
3. Functions ä»å­˜å‚¨è¯»å–

### æ–¹æ¡ˆ Bï¼šé¢„ç”Ÿæˆç´¢å¼•ï¼ˆå½“å‰æ–¹æ¡ˆï¼‰

1. åœ¨æœ¬åœ°è¿è¡Œ `python generate_index.py`
2. æäº¤ `markdown/index.json` åˆ° Git
3. å‰ç«¯ç›´æ¥ä½¿ç”¨é™æ€æ–‡ä»¶
4. ä¸ä¾èµ– Functions

### æ–¹æ¡ˆ Cï¼šä½¿ç”¨ GitHub API

1. Functions é€šè¿‡ GitHub API è¯»å–æ–‡ä»¶
2. ä¸ä¾èµ–æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
3. éœ€è¦é…ç½® GitHub Token

---

## ğŸš€ ç«‹å³æ“ä½œ

### çŸ­æœŸï¼ˆ5åˆ†é’Ÿï¼‰

1. åˆ›å»ºè¯Šæ–­å‡½æ•°ï¼ˆä¸Šé¢çš„ä»£ç ï¼‰
2. è¿è¡Œè¯Šæ–­
3. å‘Šè¯‰æˆ‘ç»“æœ

### ä¸­æœŸï¼ˆ10åˆ†é’Ÿï¼‰

1. ç¦ç”¨ Functions é‡å®šå‘
2. ç»§ç»­ä½¿ç”¨é™æ€æ–‡ä»¶
3. ç½‘ç«™æ­£å¸¸å·¥ä½œ

### é•¿æœŸï¼ˆåç»­ä¼˜åŒ–ï¼‰

1. å®ç°æ–¹æ¡ˆ A/B/C
2. æä¾›æ›´å¥½çš„åŠ¨æ€æ›´æ–°åŠŸèƒ½

---

**è¯·å…ˆè¿è¡Œè¯Šæ–­ï¼ŒæŠŠç»“æœå‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥æä¾›æ›´å‡†ç¡®çš„è§£å†³æ–¹æ¡ˆï¼**
